From 91d60983acad0e8791b94f60dad5d318b67c0166 Mon Sep 17 00:00:00 2001
From: Helix Graziani <helix.graziani@hotmail.com>
Date: Mon, 29 Jan 2024 19:24:07 -0500
Subject: [PATCH] cfgmgr32: Add CM_Get_Device_Interface_PropertyW stub.

---
 dlls/cfgmgr32/cfgmgr32.spec |  2 +-
 dlls/cfgmgr32/main.c        | 13 +++++++++++++
 include/cfgmgr32.h          |  2 ++
 3 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/dlls/cfgmgr32/cfgmgr32.spec b/dlls/cfgmgr32/cfgmgr32.spec
index e4cd845e2a41..29de7bbdc55f 100644
--- a/dlls/cfgmgr32/cfgmgr32.spec
+++ b/dlls/cfgmgr32/cfgmgr32.spec
@@ -91,7 +91,7 @@
 @ stdcall CM_Get_Device_Interface_List_SizeW(ptr ptr wstr long) setupapi.CM_Get_Device_Interface_List_SizeW
 @ stdcall CM_Get_Device_Interface_List_Size_ExA(ptr ptr str long ptr) setupapi.CM_Get_Device_Interface_List_Size_ExA
 @ stdcall CM_Get_Device_Interface_List_Size_ExW(ptr ptr wstr long ptr) setupapi.CM_Get_Device_Interface_List_Size_ExW
-@ stub CM_Get_Device_Interface_PropertyW
+@ stdcall CM_Get_Device_Interface_PropertyW(wstr ptr ptr ptr ptr long)
 @ stub CM_Get_First_Log_Conf
 @ stub CM_Get_First_Log_Conf_Ex
 @ stub CM_Get_Global_State
diff --git a/dlls/cfgmgr32/main.c b/dlls/cfgmgr32/main.c
index f40068af0df3..7d48a96be850 100644
--- a/dlls/cfgmgr32/main.c
+++ b/dlls/cfgmgr32/main.c
@@ -67,3 +67,16 @@ CONFIGRET WINAPI CM_Register_Notification( CM_NOTIFY_FILTER *filter, void *conte
 
     return CR_CALL_NOT_IMPLEMENTED;
 }
+
+/***********************************************************************
+ *           CM_Get_Device_Interface_PropertyW (cfgmgr32.@)
+ */
+CONFIGRET WINAPI CM_Get_Device_Interface_PropertyW( LPCWSTR device_interface, const DEVPROPKEY *property_key,
+                                                    DEVPROPTYPE *property_type, BYTE *property_buffer,
+                                                    ULONG *property_buffer_size, ULONG flags )
+{
+    FIXME("%s %p %p %p %p %ld stub!\n", debugstr_w(device_interface), property_key, property_type,
+          property_buffer, property_buffer_size, flags);
+
+    return CR_CALL_NOT_IMPLEMENTED;
+}
diff --git a/include/cfgmgr32.h b/include/cfgmgr32.h
index a0bb89a2a678..ee1846b0e97e 100644
--- a/include/cfgmgr32.h
+++ b/include/cfgmgr32.h
@@ -26,6 +26,7 @@
 #endif
 
 #include <winreg.h>
+#include <devpropdef.h>
 
 /* cfgmgr32 doesn't use the normal convention, it adds an underscore before A/W */
 #ifdef WINE_NO_UNICODE_MACROS
@@ -312,6 +313,7 @@ CMAPI CONFIGRET WINAPI CM_Get_Device_ID_List_ExW(PCWSTR,PWCHAR,ULONG,ULONG,HMACH
 #define     CM_Get_Device_ID_List_Ex WINELIB_NAME_AW(CM_Get_Device_ID_List_Ex)
 CMAPI CONFIGRET WINAPI CM_Get_Device_ID_Size(PULONG,DEVINST,ULONG);
 CMAPI CONFIGRET WINAPI CM_Get_Device_ID_Size_Ex(PULONG,DEVINST,ULONG,HMACHINE);
+CMAPI CONFIGRET WINAPI CM_Get_Device_Interface_PropertyW(LPCWSTR,const DEVPROPKEY*,DEVPROPTYPE*,PBYTE,PULONG,ULONG);
 CMAPI CONFIGRET WINAPI CM_Get_DevNode_Status(PULONG,PULONG,DEVINST,ULONG);
 CMAPI CONFIGRET WINAPI CM_Get_DevNode_Status_Ex(PULONG,PULONG,DEVINST,ULONG,HMACHINE);
 CMAPI CONFIGRET WINAPI CM_Get_Sibling(PDEVINST,DEVINST,ULONG);
